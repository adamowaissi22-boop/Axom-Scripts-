local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

local Arotic = {}
Arotic.__index = Arotic

function Arotic:CreateWindow(options)
    local Window = {}
    Window.__index = Window
    Window.Tabs = {}
    local gui = Instance.new("ScreenGui")
    gui.Name = options.Title or "Window"
    gui.Parent = PlayerGui
    gui.ResetOnSpawn = false

    local frame = Instance.new("Frame")
    frame.Size = options.Size or UDim2.new(0, 500, 0, 400)
    frame.Position = options.Position or UDim2.new(0.5, -250, 0.5, -200)
    frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
    frame.AnchorPoint = Vector2.new(0.5,0.5)
    frame.Parent = gui

    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0,12)
    uicorner.Parent = frame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1,0,0,30)
    titleLabel.Position = UDim2.new(0,0,0,0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = options.Title or "Window"
    titleLabel.TextColor3 = Color3.fromRGB(255,255,255)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 18
    titleLabel.Parent = frame

    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0,30,0,30)
    closeBtn.Position = UDim2.new(1,-35,0,0)
    closeBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
    closeBtn.Text = "X"
    closeBtn.TextColor3 = Color3.fromRGB(255,255,255)
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 18
    closeBtn.Parent = frame
    local uiclose = Instance.new("UICorner")
    uiclose.CornerRadius = UDim.new(0,6)
    uiclose.Parent = closeBtn

    local hideBtn = Instance.new("TextButton")
    hideBtn.Size = UDim2.new(0, 40,0,30)
    hideBtn.Position = UDim2.new(0,5,0,0)
    hideBtn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    hideBtn.Text = "~"
    hideBtn.TextColor3 = Color3.fromRGB(255,255,255)
    hideBtn.Font = Enum.Font.GothamBold
    hideBtn.TextSize = 20
    hideBtn.Parent = frame
    local uihide = Instance.new("UICorner")
    uihide.CornerRadius = UDim.new(0,6)
    uihide.Parent = hideBtn

    local showBtn = Instance.new("TextButton")
    showBtn.Size = UDim2.new(0,60,0,30)
    showBtn.Position = UDim2.new(0.5,-30,0,5)
    showBtn.BackgroundColor3 = Color3.fromRGB(40,40,40)
    showBtn.Text = "show"
    showBtn.TextColor3 = Color3.fromRGB(255,255,255)
    showBtn.Font = Enum.Font.GothamBold
    showBtn.TextSize = 16
    showBtn.Visible = false
    showBtn.Parent = PlayerGui
    local uishow = Instance.new("UICorner")
    uishow.CornerRadius = UDim.new(0,6)
    uishow.Parent = showBtn

    hideBtn.MouseButton1Click:Connect(function()
        frame.Visible = false
        showBtn.Visible = true
    end)
    showBtn.MouseButton1Click:Connect(function()
        frame.Visible = true
        showBtn.Visible = false
    end)

    local tabBar = Instance.new("Frame")
    tabBar.Size = UDim2.new(1,0,0,30)
    tabBar.Position = UDim2.new(0,0,0,30)
    tabBar.BackgroundTransparency = 1
    tabBar.Parent = frame

    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1,-10,1,-70)
    contentFrame.Position = UDim2.new(0,5,0,60)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = frame

    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X,startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)

    Window.Frame = frame
    Window.Gui = gui
    Window.ShowButton = showBtn
    Window.TabBar = tabBar
    Window.ContentFrame = contentFrame
    setmetatable(Window, Window)
    setmetatable(Window, {__index = Arotic})
    return Window
end

function Arotic:CreateTab(name)
    local Tab = {}
    Tab.Sections = {}
    Tab.Name = name

    local tabButton = Instance.new("TextButton")
    tabButton.Size = UDim2.new(0,100,1,0)
    tabButton.Position = UDim2.new(#self.Tabs*0,0,0,0)
    tabButton.BackgroundTransparency = 1
    tabButton.Text = name
    tabButton.TextColor3 = Color3.fromRGB(255,255,255)
    tabButton.Font = Enum.Font.Gotham
    tabButton.TextSize = 16
    tabButton.Parent = self.TabBar

    tabButton.MouseButton1Click:Connect(function()
        for _,t in pairs(self.Tabs) do
            if t.ContentFrame then
                t.ContentFrame.Visible = false
            end
        end
        if Tab.ContentFrame then
            Tab.ContentFrame.Visible = true
        end
    end)

    local contentFrame = Instance.new("Frame")
    contentFrame.Size = UDim2.new(1,0,1,0)
    contentFrame.Position = UDim2.new(0,0,0,0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.Parent = self.ContentFrame
    contentFrame.Visible = (#self.Tabs==0)

    Tab.ContentFrame = contentFrame
    Tab.Frame = contentFrame
    setmetatable(Tab, Tab)
    setmetatable(Tab, {__index = Arotic})
    table.insert(self.Tabs, Tab)
    return Tab
end

function Arotic:CreateSection(name)
    local Section = {}
    Section.Elements = {}
    Section.Name = name

    local sectionFrame = Instance.new("Frame")
    sectionFrame.Size = UDim2.new(1,0,0,100)
    sectionFrame.BackgroundTransparency = 1
    sectionFrame.LayoutOrder = #self.Sections*110
    sectionFrame.Parent = self.Frame

    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0,10)
    layout.FillDirection = Enum.FillDirection.Vertical
    layout.Parent = sectionFrame

    Section.SectionFrame = sectionFrame
    setmetatable(Section, Section)
    setmetatable(Section, {__index = Arotic})
    table.insert(self.Sections, Section)
    return Section
end

function Arotic:CreateButton(name, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-20,0,40)
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.Parent = self.SectionFrame
    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0,8)
    uicorner.Parent = btn
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(70,70,70)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(50,50,50)}):Play()
    end)
    btn.MouseButton1Click:Connect(callback)
    table.insert(self.Elements, btn)
end

function Arotic:CreateToggle(name, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1,-20,0,40)
    frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
    frame.Parent = self.SectionFrame
    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0,8)
    uicorner.Parent = frame
    local label = Instance.new("TextLabel")
    label.Text = name
    label.Size = UDim2.new(0.7,0,1,0)
    label.Position = UDim2.new(0,10,0,0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.Parent = frame
    local toggleBtn = Instance.new("TextButton")
    toggleBtn.Size = UDim2.new(0,40,0,25)
    toggleBtn.Position = UDim2.new(1,-50,0.5,-12)
    toggleBtn.BackgroundColor3 = Color3.fromRGB(200,50,50)
    toggleBtn.Text = ""
    toggleBtn.Parent = frame
    local uic = Instance.new("UICorner")
    uic.CornerRadius = UDim.new(0,12)
    uic.Parent = toggleBtn
    local toggled = false
    toggleBtn.MouseButton1Click:Connect(function()
        toggled = not toggled
        toggleBtn.BackgroundColor3 = toggled and Color3.fromRGB(50,200,50) or Color3.fromRGB(200,50,50)
        callback(toggled)
    end)
    table.insert(self.Elements, frame)
end

function Arotic:CreateTextbox(name, placeholder, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1,-20,0,40)
    frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
    frame.Parent = self.SectionFrame
    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0,8)
    uicorner.Parent = frame

    local label = Instance.new("TextLabel")
    label.Text = name
    label.Size = UDim2.new(0.4,0,1,0)
    label.Position = UDim2.new(0,10,0,0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.Gotham
    label.TextSize = 16
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local box = Instance.new("TextBox")
    box.Size = UDim2.new(0.55,0,0.7,0)
    box.Position = UDim2.new(0.45,0,0.15,0)
    box.BackgroundColor3 = Color3.fromRGB(70,70,70)
    box.TextColor3 = Color3.fromRGB(255,255,255)
    box.PlaceholderText = placeholder or ""
    box.Font = Enum.Font.Gotham
    box.TextSize = 16
    box.ClearTextOnFocus = false
    box.Parent = frame
    local boxCorner = Instance.new("UICorner")
    boxCorner.CornerRadius = UDim.new(0,6)
    boxCorner.Parent = box

    box.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            callback(box.Text)
        end
    end)

    table.insert(self.Elements, frame)
end

function Arotic:CreateLoadingButton(name)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-20,0,40)
    btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Text = name
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 16
    btn.Parent = self.SectionFrame
    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0,8)
    uicorner.Parent = btn

    local loading = Instance.new("Frame")
    loading.Size = UDim2.new(0,0,1,0)
    loading.Position = UDim2.new(0,0,0,0)
    loading.BackgroundColor3 = Color3.fromRGB(70,70,70)
    loading.Parent = btn
    local loadingCorner = Instance.new("UICorner")
    loadingCorner.CornerRadius = UDim.new(0,8)
    loadingCorner.Parent = loading

    local function StartLoading()
        TweenService:Create(loading, TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1, true), {Size=UDim2.new(1,0,1,0)}):Play()
    end
    local function StopLoading()
        loading.Size = UDim2.new(0,0,1,0)
    end

    btn.MouseButton1Click:Connect(function()
        StartLoading()
        task.spawn(function()
            task.wait(2)
            StopLoading()
        end)
    end)

    table.insert(self.Elements, btn)
end

return Arotic
